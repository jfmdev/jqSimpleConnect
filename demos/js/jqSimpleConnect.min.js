/*
 * «Copyright 2012 José F. Maldonado»
 *
 * This Source Code Form is subject to the terms of the Mozilla Public License, v. 2.0. If a copy of the MPL was not distributed with this file, You can obtain one at http://mozilla.org/MPL/2.0/.
 */
jqSimpleConnect=new Object,jqSimpleConnect._idGenerator=0,jqSimpleConnect._connections=new Object,jqSimpleConnect._positionConnection=function(e){var n=e.elementA.offset();n.left=parseInt(n.left,10)+parseInt(e.elementA.outerWidth()/2,10),n.top=parseInt(n.top,10)+parseInt(e.elementA.outerHeight()/2,10);var o=e.elementB.offset();o.left=parseInt(o.left,10)+parseInt(e.elementB.outerWidth()/2,10),o.top=parseInt(o.top,10)+parseInt(e.elementB.outerHeight()/2,10);var t=jQuery("#"+e.id+"_1"),i=jQuery("#"+e.id+"_2"),r=jQuery("#"+e.id+"_3");if(n.left==o.left||n.top==o.top)t.show(),i.hide(),r.hide(),n.left==o.left?jqSimpleConnect._positionVerticalLine(t,n,o,e.radius,e.roundedCorners):jqSimpleConnect._positionHorizontalLine(t,n,o,e.radius,e.roundedCorners);else if(e.anchorA!=e.anchorB){t.show(),i.show(),r.hide();var l=new Object;"vertical"==e.anchorA?(l.left=n.left,l.top=o.top,jqSimpleConnect._positionVerticalLine(t,n,l,e.radius,e.roundedCorners),jqSimpleConnect._positionHorizontalLine(i,o,l,e.radius,e.roundedCorners)):(l.left=o.left,l.top=n.top,jqSimpleConnect._positionVerticalLine(t,o,l,e.radius,e.roundedCorners),jqSimpleConnect._positionHorizontalLine(i,n,l,e.radius,e.roundedCorners))}else{t.show(),i.show(),r.show();var c=new Object,s=new Object;"vertical"==e.anchorA?(c.top=parseInt((n.top+o.top)/2,10),s.top=c.top,c.left=n.left,s.left=o.left,jqSimpleConnect._positionVerticalLine(t,n,c,e.radius,e.roundedCorners),jqSimpleConnect._positionVerticalLine(i,o,s,e.radius,e.roundedCorners),jqSimpleConnect._positionHorizontalLine(r,c,s,e.radius,e.roundedCorners)):(c.left=parseInt((n.left+o.left)/2,10),s.left=c.left,c.top=n.top,s.top=o.top,jqSimpleConnect._positionHorizontalLine(t,n,c,e.radius,e.roundedCorners),jqSimpleConnect._positionHorizontalLine(i,o,s,e.radius,e.roundedCorners),jqSimpleConnect._positionVerticalLine(r,c,s,e.radius,e.roundedCorners))}},jqSimpleConnect._positionVerticalLine=function(e,n,o,t,i){var r=parseInt(t/2,10);e.css("left",n.left-r),e.css("top",n.top>o.top?o.top-r:n.top-r),e.css("width",t+"px"),e.css("height",(n.top>o.top?n.top-o.top+t:o.top-n.top+t)+"px")},jqSimpleConnect._positionHorizontalLine=function(e,n,o,t,i){var r=parseInt(t/2,10);e.css("top",n.top-r),e.css("left",n.left>o.left?o.left-r:n.left-r),e.css("height",t+"px"),e.css("width",(n.left>o.left?n.left-o.left+t:o.left-n.left+t)+"px")},jqSimpleConnect.connect=function(e,n,o){if(null==e||0==jQuery(e).size()||null==n||0==jQuery(n).size())return null;(e=jQuery(e)).size()>1&&(e=e.first()),(n=jQuery(n)).size()>1&&(n=n.first());var t=new Object;t.id="jqSimpleConnect_"+jqSimpleConnect._idGenerator++,t.elementA=e,t.elementB=n,t.color=null!=o&&null!=o.color?o.color+"":"#808080",t.radius=null==o||null==o.radius||isNaN(o.radius)?5:parseInt(o.radius,10),t.anchorA=null==o||null==o.anchorA||"vertical"!=o.anchorA&&"horizontal"!=o.anchorA?"horizontal":o.anchorA,t.anchorB=null==o||null==o.anchorB||"vertical"!=o.anchorB&&"horizontal"!=o.anchorB?"horizontal":o.anchorB,t.roundedCorners=null!=o&&null!=o.roundedCorners&&(1==o.roundedCorners||"true"==o.roundedCorners),t.click=null!=o&&null!=o.click?o.click:null,t.mouseover=null!=o&&null!=o.mouseover?o.mouseover:null,t.mouseout=null!=o&&null!=o.mouseout?o.mouseout:null,jqSimpleConnect._connections[t.id]=t;var i='<div id="divUniqueIdentifier" class="jqSimpleConnect '+t.id+'" style="width:'+t.radius+"px; height:"+t.radius+"px; background-color:"+t.color+"; "+(t.roundedCorners?"border-radius:"+parseInt(t.radius/2,10)+"px; -webkit-border-radius:"+parseInt(t.radius/2,10)+"px; -moz-border-radius:"+parseInt(t.radius/2,10)+"px; ":"")+'position:absolute;"></div>';return jQuery("body").prepend(i.replace("divUniqueIdentifier",t.id+"_1")),jQuery("body").prepend(i.replace("divUniqueIdentifier",t.id+"_2")),jQuery("body").prepend(i.replace("divUniqueIdentifier",t.id+"_3")),jQuery("."+t.id).click(function(){"function"==typeof t.click&&t.click(t)}).on("mouseover",function(){"function"==typeof t.mouseover&&t.mouseover(t)}).on("mouseout",function(){"function"==typeof t.mouseout&&t.mouseout(t)}),jqSimpleConnect._positionConnection(t),t.id},jqSimpleConnect.repaintConnection=function(e){var n=jqSimpleConnect._connections[e];return null!=n&&(jqSimpleConnect._positionConnection(n),!0)},jqSimpleConnect.repaintAll=function(){for(var e in jqSimpleConnect._connections)jqSimpleConnect._positionConnection(jqSimpleConnect._connections[e])},jqSimpleConnect.removeConnection=function(e){return null!=jqSimpleConnect._connections[e]&&(jQuery(".jqSimpleConnect."+e).remove(),jqSimpleConnect._connections[e]=null,delete jqSimpleConnect._connections[e],!0)},jqSimpleConnect.removeAll=function(){for(var e in jQuery(".jqSimpleConnect").remove(),jqSimpleConnect._connections)jqSimpleConnect._connections[e]=null,delete jqSimpleConnect._connections[e]};


